{
  "name": "Web Legacy Protected App",
  "baseURI": "https://miamitest.frdpcloud.com",
  "condition": "${matches(request.uri.path, '^(/web|/agent|/apps/frdp/rest/apps/web|/apps/frdp/themes/default/apps/web/css/|/apps/frdp/themes/default/apps/web/images/)')}",
  "capture": [
    "response",
    "request"
  ],
  "handler": "Chain",
  "heap": [
    {
      "name": "Chain",
      "type": "Chain",
      "config": {
        "filters": [
          "Set-Response-Location",
          "ChangeLocationFilter-Response",
          "CookieDomainFilter"
        ],
        "handler": "ReverseProxyHandler"
      }
    },
    {
      "name": "CookieDomainFilter",
      "type": "org.forgerock.openig.miami.filter.CookieDomainFilter",
      "config": {}
    },
    {
      "name": "Set-Response-Location",
      "type": "AssignmentFilter",
      "config": {
        "onResponse": [
          {
            "target": "${attributes.responseLocation}",
            "value": "${response.headers['Location'][0]}"
          },
          {
            "target": "${attributes.originalUri}",
            "value": "${request.uri.query}"
          }
        ]
      }
    },
    {
      "name": "ChangeLocationFilter-Response",
      "type": "LocationHeaderFilter",
      "config": {
        "baseURI": "https://ig.dev.miami-accelerators.com"
      }
    },
    {
      "name": "ReverseProxyHandler",
      "type": "ReverseProxyHandler",
      "config": {
        "connectionTimeout": "120 seconds",
        "soTimeout": "unlimited"
      },
      "capture": [
        "response",
        "request"
      ]
    }
  ]
}
{
  "name": "Legacy AM Authenticate Route",
  "baseURI": "https://as.legacy.miami-accelerators.com",
  "condition": "${matches(request.uri.path, '^/openam/json/realms/root/realms/legacy/authenticate')}",
  "capture": [
    "response",
    "request"
  ],
  "heap": [
    {
      "name": "ReverseProxyHandler",
      "type": "ReverseProxyHandler",
      "capture": [
        "response",
        "request"
      ]
    },
    {
      "name": "capture",
      "type": "CaptureDecorator",
      "config": {
        "captureEntity": true,
        "captureContext": true
      }
    },
    {
      "name": "ForgeRockClientHandler",
      "type": "Chain",
      "config": {
        "filters": [
          "TransactionIdOutboundFilter"
        ],
        "handler": "ClientHandler"
      },
      "capture": [
        "response",
        "request"
      ]
    }
  ],
  "handler": {
    "type": "Chain",
    "config": {
      "filters": [
        {
          "name": "HeaderFilter-ChangeHost-1",
          "type": "HeaderFilter",
          "config": {
            "messageType": "REQUEST",
            "remove": [
              "host",
              "x-forwarded-host"
            ],
            "add": {
              "host": [
                "as.legacy.miami-accelerators.com"
              ],
              "x-forwarded-host": [
                "as.legacy.miami-accelerators.com"
              ]
            }
          }
        },
        {
          "name": "HeaderAuthenticationProvisioningFilter",
          "type": "HeaderAuthenticationProvisioningFilter",
          "config": {
            "idmURL": "https://idm.dev.miami-accelerators.com/openidm/managed/user?_action=create",
            "openIdmPassword": "openidm-admin",
            "openIdmUsername": "openidm-admin"
          }
        }
      ],
      "handler": "ReverseProxyHandler"
    }
  }
}